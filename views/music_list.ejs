<%- include('partials/header') %>

<div class="max-w-xl mx-auto min-h-screen flex flex-col bg-dark-900 pb-24">
    
    <div class="p-6 flex justify-between items-center sticky top-0 bg-dark-900/95 backdrop-blur-sm z-20 border-b border-white/5">
        <h1 class="text-2xl font-bold text-white flex items-center gap-2">
            <i data-lucide="headphones" class="w-6 h-6 text-rose-500"></i> Music Lounge
        </h1>
        <a href="/dashboard" class="p-2 rounded-full hover:bg-white/5 text-gray-400 hover:text-white transition">
            <i data-lucide="home" class="w-6 h-6"></i>
        </a>
    </div>

    <div class="px-4 mb-6 mt-4">
        <a href="/create-music" class="block bg-gradient-to-r from-rose-600 to-pink-600 p-4 rounded-2xl shadow-lg shadow-rose-600/20 hover:scale-[1.02] transition active:scale-95 text-center group">
            <span class="text-white font-bold flex items-center justify-center gap-2">
                <i data-lucide="plus-circle" class="w-5 h-5 group-hover:rotate-90 transition duration-300"></i> Buat Room Baru
            </span>
        </a>
    </div>

    <div class="px-4 space-y-3 overflow-y-auto pb-10">
        <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 ml-1">Room Aktif</h3>

        <% if(sessions.length === 0) { %>
            <div class="flex flex-col items-center justify-center py-16 opacity-50 space-y-4">
                <div class="w-20 h-20 bg-dark-800 rounded-full flex items-center justify-center">
                    <i data-lucide="music" class="w-10 h-10 text-gray-600"></i>
                </div>
                <p class="text-gray-400 text-sm font-medium">Belum ada party musik.</p>
            </div>
        <% } else { %>
            
            <% sessions.forEach(s => { %>
                <div class="relative group animate-fade-in">
                    
                    <a href="/music/<%= s.id %>" class="block bg-dark-800 p-4 rounded-2xl border border-dark-700 hover:border-rose-500/50 transition relative overflow-hidden">
                        <div class="absolute -right-4 -top-4 w-24 h-24 bg-rose-500/10 rounded-full blur-2xl group-hover:bg-rose-500/20 transition"></div>
                        
                        <div class="flex items-center justify-between pr-8 relative z-10"> 
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-full bg-rose-500/10 text-rose-500 flex items-center justify-center border border-rose-500/20 group-hover:scale-110 transition">
                                    <i data-lucide="play-circle" class="w-6 h-6 fill-current opacity-80"></i>
                                </div>
                                
                                <div class="min-w-0">
                                    <h3 class="text-white font-bold text-base truncate w-40 sm:w-auto group-hover:text-rose-400 transition">
                                        <%= s.name || 'Vibe Session' %>
                                    </h3>
                                    <p class="text-xs text-gray-400 flex items-center gap-1.5 mt-0.5">
                                        <i data-lucide="user" class="w-3 h-3 text-gray-500"></i> 
                                        <span class="<%= user.id === s.hostId ? 'text-rose-300 font-bold' : '' %>">
                                            <%= s.hostName %> <%= user.id === s.hostId ? '(You)' : '' %>
                                        </span>
                                    </p>
                                </div>
                            </div>
                            
                            <div class="text-right shrink-0">
                                <span class="text-[10px] font-bold text-gray-300 bg-black/40 px-2.5 py-1 rounded-lg border border-white/5 flex items-center gap-1">
                                    <i data-lucide="list-music" class="w-3 h-3"></i> <%= s.playlist ? s.playlist.length : 0 %>
                                </span>
                            </div>
                        </div>
                    </a>

                    <% if(user.id === s.hostId || user.role === 'admin') { %>
                        <form action="/music/delete" method="POST" class="absolute top-1/2 -translate-y-1/2 right-3 z-20 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition duration-200" onsubmit="return confirm('Hapus room ini? Semua file lagu di dalamnya juga akan dihapus permanen.')">
                            <input type="hidden" name="roomId" value="<%= s.id %>">
                            <button type="submit" class="p-2.5 bg-dark-900 text-gray-400 hover:text-red-500 hover:bg-white rounded-xl border border-dark-600 shadow-xl" title="Hapus Room">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </form>
                    <% } %>

                </div>
            <% }) %>
        <% } %>
    </div>
</div>

<script>
    lucide.createIcons();
</script>
<%- include('partials/system_scripts') %>
</body>
</html>